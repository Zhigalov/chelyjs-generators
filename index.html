<!DOCTYPE HTML>
<html lang="ru">
<head>
    <title>Generators</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1274, user-scalable=no">
    <link rel="stylesheet" href="styles/screen.css">
    <link rel="stylesheet" href="styles/print.css" media="print">
    <link rel="stylesheet" href="styles/idea.min.css">
    <link rel="shortcut icon" href="favicon.ico">
</head>
<body class="list">
<header class="caption">
    <h1>Generators</h1>

    <p>Жигалов Сергей</p>
</header>
<section class="slide first">
    <div class="arrow">
        <img src="images/yandex_lang_ru.svg" class="yandex"/>

        <h2>Generators</h2>

        <div class="info">
            <p class="author"><span class="first-red">С</span>ергей Жигалов</p>

            <p class="location">EkbJS, 2015г</p>
        </div>
    </div>
</section>

<section class="slide">
    <h2>Generator</h2>

    <p><strike>ES6</strike> ES2015</p>

    <div>
        <quote>A generator can pause itself in mid-execution, and can be resumed
            either right away or at a later time.
        </quote>
    </div>
</section>

<section class="slide">
    <h2>Generator</h2>

    <ul>
        <li>node >= 0.11 --harmony или --harmony-generators</li>
        <li>TODO: поддержка браузеров</li>
    </ul>
</section>

<section class="slide">
    <h2><small>Generator.</small> Declaration</h2>
    <pre class="javascript">
        <code>function <mark>*</mark>foo() {</code>
        <code>    // ...</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <h2><small>Generator.</small> Execution</h2>
    <pre class="javascript">
        <code>function *foo(name) {</code>
        <code>    console.log('Hello, ' + name);</code>
        <code>}</code>
        <code> </code>
        <code>foo('EkbJS');</code>
    </pre>

    <h3>Console:</h3>
    <pre class="javascript">
        <code>&gt;</code>
    </pre>
</section>

<section class="slide">
    <h2><small>Generator.</small> Execution</h2>
    <pre class="javascript">
        <code>function *foo(name) {</code>
        <code>    console.log('Hello, ' + name);</code>
        <code>}</code>
        <code> </code>
        <code>var it = foo('EkbJS');</code>
        <code>it.next();</code>
    </pre>

    <h3>Console:</h3>
    <pre class="javascript">
        <code>&gt; Hello, EkbJS</code>
    </pre>
</section>

<section class="slide">
    <h2><small>Generator.</small> yield</h2>
    <pre class="javascript">
        <code>function *foo(name) {</code>
        <code>    console.log('Hello, ' + name);</code>
        <code>    <mark>yield;</mark></code>
        <code>    console.log('Goodbye, ' + name);</code>
        <code>}</code>
        <code> </code>
        <code>var it = foo('EkbJS');</code>
        <code>it.next();</code>
        <code>// Do somethings...</code>
        <code>it.next();</code>
    </pre>

    <div class="console_position">
        <h3>Console:</h3>
        <pre>
            <code>&gt;</code>
            <code>&gt; Hello, EkbJS</code>
            <code>&gt;</code>
            <code>&gt; Goodbye, EkbJS</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2><small>Generator.</small> Receive data</h2>
    <pre class="javascript">
        <code>function *foo() {</code>
        <code>    <mark>yield 'Some data';</mark></code>
        <code>}</code>
        <code> </code>
        <code>var it = foo();</code>
        <code>console.log(it.next());</code>
    </pre>

    <div>
        <h3>Console:</h3>
        <pre>
            <code>&gt; {value: "Some data", done: false}</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2><small>Generator.</small> Send data</h2>
    <pre class="javascript">
        <code>function *foo() {</code>
        <code>    var name = <mark>yield;</mark></code>
        <code>    console.log('Hello, ' + name);</code>
        <code>}</code>
        <code> </code>
        <code>var it = foo();</code>
        <code>it.next();</code>
        <code><mark>it.next('EkbJS');</mark></code>
    </pre>

    <div>
        <h3>Console:</h3>
        <pre>
            <code>&gt; Hello, EkbJS</code>
        </pre>
    </div>
</section>

<!-- Не забыть рассказать про приоритеты -->
<section class="slide">
    <h2><small>Generator.</small> Send data</h2>
    <pre class="javascript">
        <code>function *foo() {</code>
        <code>    var name = <mark>'EkbJS';</mark></code>
        <code>    console.log('Hello, ' + name);</code>
        <code>}</code>
        <code> </code>
        <code>var it = foo();</code>
        <code>it.next();</code>
        <code><mark>it.next('EkbJS');</mark></code>
    </pre>

    <div>
        <h3>Console:</h3>
        <pre>
            <code>&gt; Hello, EkbJS</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2><small>Generator.</small> yield *</h2>
    <pre class="javascript">
        <code>function *foo() {</code>
        <code>    yield 2;</code>
        <code>    yield 3;</code>
        <code>}</code>
        <code> </code>
        <code>function *bar() {</code>
        <code>    yield 1;</code>
        <code>    yield *foo();</code>
        <code>}</code>
        <code> </code>
        <code>var it = bar();</code>
        <code>console.log(it.next());</code>
        <code>console.log(it.next());</code>
        <code>console.log(it.next());</code>
    </pre>

    <div class="console_position" style="top: 464px">
        <h3>Console:</h3>
        <pre>
            <code>&gt; {value: 1, done: false}</code>
            <code>&gt; {value: 2, done: false}</code>
            <code>&gt; {value: 3, done: false}</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2><small>Generator.</small> yield *</h2>
    <pre class="javascript">
        <code>function *foo() {</code>
        <code>    yield 2;</code>
        <code>    yield 3;</code>
        <code>}</code>
        <code> </code>
        <code>function *bar() {</code>
        <code>    yield 1;</code>
        <code>    yield *foo();</code>
        <code>}</code>
        <code> </code>
        <code>for(var val of bar()) {</code>
        <code>    console.log(val);</code>
        <code>}</code>
    </pre>

    <div class="console_position" style="top: 464px">
        <h3>Console:</h3>
        <pre>
            <code>&gt; 1</code>
            <code>&gt; 2</code>
            <code>&gt; 3</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2><small>Асинхронность.</small> Задача</h2>
    <h3>Неоплаченные штрафы</h3>
    <ul>
        <li>Ввести номер автомобиля и номер прав</li>
        <li>Получить по номеру автомобиля список штрафов</li>
        <li>Получить по номеру прав список штрафов</li>
        <li>Объединить два списка</li>
        <li>Получить по каждому штрафу статус оплаты</li>
        <li>Вывести неоплаченные штрафы</li>
    </ul>
</section>

<section class="slide">
    <h2 class="async_header">
        <small>Асинхронность.</small><br/>
        Callback
    </h2>
    <pre class="javascript" style="position: absolute; top: 0">
        <code>function getUnpaidFines(carNumber, driverCard, cb) {</code>
        <code>    var fines = [], readyCounter = 0;</code>
        <code>    function onGetFinesReady(data) {</code>
        <code>        fines = fines.concat(data);</code>
        <code>        if (++readyCounter < 2) { return; }</code>
        <code>        var unpaidFines = [];</code>
        <code>        (function getUnpaidFines() {</code>
        <code>            if (!fines.length) {</code>
        <code>                return cb(unpaidFines);</code>
        <code>            }</code>
        <code>            var fine = fines.shift();</code>
        <code>            isFinesUnpaid(fine, function (isUnpaid) {</code>
        <code>                isUnpaid && unpaidFines.push(fine);</code>
        <code>                getUnpaidFines();</code>
        <code>            });</code>
        <code>        })();</code>
        <code>    }</code>
        <code>    getFinesByCarNumber(carNumber, onGetFinesReady);</code>
        <code>    getFinesByDriverCard(driverCard, onGetFinesReady);</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <h2 class="async_header">
        <small>Асинхронность.</small><br/>
        Callback
    </h2>
    <pre class="javascript" style="position: absolute; top: 0">
        <code>function getUnpaidFines(carNumber, driverCard, cb) {</code>
        <code>    var fines = [], readyCounter = 0;</code>
        <code>    function onGetFinesReady(data) {</code>
        <code>        fines = fines.concat(data);</code>
        <code>        if (++readyCounter < 2) { return; }</code>
        <code>        var unpaidFines = [];</code>
        <code>        (function getUnpaidFines() {</code>
        <code>            if (!fines.length) {</code>
        <code>                return cb(unpaidFines);</code>
        <code>            }</code>
        <code>            var fine = fines.shift();</code>
        <code>            isFinesUnpaid(fine, function (isUnpaid) {</code>
        <code>                isUnpaid && unpaidFines.push(fine);</code>
        <code>                getUnpaidFines();</code>
        <code>            });</code>
        <code>        })();</code>
        <code>    }</code>
        <code>    <mark>getFinesByCarNumber</mark>(carNumber, onGetFinesReady);</code>
        <code>    <mark>getFinesByDriverCard</mark>(driverCard, onGetFinesReady);</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <h2 class="async_header">
        <small>Асинхронность.</small><br/>
        Callback
    </h2>
    <pre class="javascript" style="position: absolute; top: 0">
        <code>function getUnpaidFines(carNumber, driverCard, cb) {</code>
        <code>    var fines = [], readyCounter = 0;</code>
        <code>    function <mark>onGetFinesReady</mark>(data) {</code>
        <code>        fines = fines.concat(data);</code>
        <code>        if (++readyCounter < 2) { return; }</code>
        <code>        var unpaidFines = [];</code>
        <code>        (function getUnpaidFines() {</code>
        <code>            if (!fines.length) {</code>
        <code>                return cb(unpaidFines);</code>
        <code>            }</code>
        <code>            var fine = fines.shift();</code>
        <code>            isFinesUnpaid(fine, function (isUnpaid) {</code>
        <code>                isUnpaid && unpaidFines.push(fine);</code>
        <code>                getUnpaidFines();</code>
        <code>            });</code>
        <code>        })();</code>
        <code>    }</code>
        <code>    getFinesByCarNumber(carNumber, <mark>onGetFinesReady</mark>);</code>
        <code>    getFinesByDriverCard(driverCard, <mark>onGetFinesReady</mark>);</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <h2 class="async_header">
        <small>Асинхронность.</small><br/>
        Callback
    </h2>
    <pre class="javascript" style="position: absolute; top: 0">
        <code>function getUnpaidFines(carNumber, driverCard, cb) {</code>
        <code>    var fines = [], readyCounter = 0;</code>
        <code>    function onGetFinesReady(data) {</code>
        <code>        fines = fines.concat(data);</code>
        <code>        <mark>if (++readyCounter < 2) { return; }</mark></code>
        <code>        var unpaidFines = [];</code>
        <code>        (function getUnpaidFines() {</code>
        <code>            if (!fines.length) {</code>
        <code>                return cb(unpaidFines);</code>
        <code>            }</code>
        <code>            var fine = fines.shift();</code>
        <code>            isFinesUnpaid(fine, function (isUnpaid) {</code>
        <code>                isUnpaid && unpaidFines.push(fine);</code>
        <code>                getUnpaidFines();</code>
        <code>            });</code>
        <code>        })();</code>
        <code>    }</code>
        <code>    getFinesByCarNumber(carNumber, onGetFinesReady);</code>
        <code>    getFinesByDriverCard(driverCard, onGetFinesReady);</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <h2 class="async_header">
        <small>Асинхронность.</small><br/>
        Callback
    </h2>
    <pre class="javascript" style="position: absolute; top: 0">
        <code>function getUnpaidFines(carNumber, driverCard, cb) {</code>
        <code>    var fines = [], readyCounter = 0;</code>
        <code>    function onGetFinesReady(data) {</code>
        <code>        fines = fines.concat(data);</code>
        <code>        if (++readyCounter < 2) { return; }</code>
        <code>        var unpaidFines = [];</code>
        <code>        (function <mark>getUnpaidFines</mark>() {</code>
        <code>            if (!fines.length) {</code>
        <code>                return cb(unpaidFines);</code>
        <code>            }</code>
        <code>            var fine = fines.shift();</code>
        <code>            isFinesUnpaid(fine, function (isUnpaid) {</code>
        <code>                isUnpaid && unpaidFines.push(fine);</code>
        <code>                getUnpaidFines();</code>
        <code>            });</code>
        <code>        })<mark>()</mark>;</code>
        <code>    }</code>
        <code>    getFinesByCarNumber(carNumber, onGetFinesReady);</code>
        <code>    getFinesByDriverCard(driverCard, onGetFinesReady);</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <h2 class="async_header">
        <small>Асинхронность.</small><br/>
        Callback
    </h2>
    <pre class="javascript" style="position: absolute; top: 0">
        <code>function getUnpaidFines(carNumber, driverCard, cb) {</code>
        <code>    var fines = [], readyCounter = 0;</code>
        <code>    function onGetFinesReady(data) {</code>
        <code>        fines = fines.concat(data);</code>
        <code>        if (++readyCounter < 2) { return; }</code>
        <code>        var unpaidFines = [];</code>
        <code>        (function getUnpaidFines() {</code>
        <code>            if (!fines.length) {</code>
        <code>                <mark>return cb(unpaidFines);</mark></code>
        <code>            }</code>
        <code>            var fine = fines.shift();</code>
        <code>            isFinesUnpaid(fine, function (isUnpaid) {</code>
        <code>                isUnpaid && unpaidFines.push(fine);</code>
        <code>                getUnpaidFines();</code>
        <code>            });</code>
        <code>        })();</code>
        <code>    }</code>
        <code>    getFinesByCarNumber(carNumber, onGetFinesReady);</code>
        <code>    getFinesByDriverCard(driverCard, onGetFinesReady);</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <h2 class="async_header">
        <small>Асинхронность.</small><br/>
        Callback
    </h2>
    <pre class="javascript" style="position: absolute; top: 0">
        <code>function getUnpaidFines(carNumber, driverCard, cb) {</code>
        <code>    var fines = [], readyCounter = 0;</code>
        <code>    function onGetFinesReady(data) {</code>
        <code>        fines = fines.concat(data);</code>
        <code>        if (++readyCounter < 2) { return; }</code>
        <code>        var unpaidFines = [];</code>
        <code>        (function getUnpaidFines() {</code>
        <code>            if (!fines.length) {</code>
        <code>                return cb(unpaidFines);</code>
        <code>            }</code>
        <code>            var fine = fines.shift();</code>
        <code>            <mark>isFinesUnpaid</mark>(fine, function (isUnpaid) {</code>
        <code>                isUnpaid && <mark>unpaidFines.push(fine);</mark></code>
        <code>                getUnpaidFines();</code>
        <code>            });</code>
        <code>        })();</code>
        <code>    }</code>
        <code>    getFinesByCarNumber(carNumber, onGetFinesReady);</code>
        <code>    getFinesByDriverCard(driverCard, onGetFinesReady);</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <h2><small>Асинхронность.</small>Callback</h2>
    <ul class="custom-list">
        <li class="done">Минимум накладных расходов</li>
        <li class="fail">Обработка ошибок
            <ul>
                <li><strike>try { ... } catch(e) { ... }</strike></li>
                <li>cb(err, data)</li>
                <li>if (error) { ... }</li>
            </ul>
        </li>
        <li class="fail">Код нужно читать в обратном порядке</li>
    </ul>
</section>

<div class="progress">
    <div></div>
</div>

<script src="js/jquery.min.js"></script>
<script src="js/highlight.min.js"></script>
<script src="js/shower.min.js"></script>
<script src="js/index.js"></script>
</body>
</html>
